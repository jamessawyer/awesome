ç¬¬8ç« çš„å†…å®¹æ¢—æ¦‚ï¼š

1. **Object** ä¸Šçš„éƒ¨åˆ†å±æ€§å’Œæ–¹æ³•
2. å¯¹è±¡è§£æ„çš„ç†è§£
3. ç†è§£åŸå‹å’ŒåŸå‹é“¾
4. åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼
5. ES6ä¹‹å‰çš„å‡ ç§ç»§æ‰¿æ–¹å¼çš„å†™æ³•ä»¥åŠä¼˜ç¼ºç‚¹
6. ES6 classè¯­æ³•ç³–ï¼Œå¦‚ä½•æ¨¡æ‹ŸæŠ½è±¡ç±»

## 1.å±æ€§çš„ç±»å‹

å±æ€§åˆ†ä¸ºï¼š

1. æ•°æ®å±æ€§
2. è®¿é—®å±æ€§ getter & setter



> 1. æ•°æ®å±æ€§

åŒ…å«ä¿å­˜æ•°æ®å€¼çš„ä½ç½®ï¼š

1. **`[[Configurable]]`**: è¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ `delete` åˆ é™¤å¹¶é‡æ–°å®šä¹‰ï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹å®ƒçš„ç‰¹æ€§ï¼Œä»¥åŠæ˜¯å¦å¯æŠŠå®ƒæ”¹ä¸ºè®¿é—®å™¨å±æ€§ï¼Œé»˜è®¤ä¸º `true`ï¼›âš ï¸å¦‚æœè®¾ç½®ä¸º `false`, åˆ™ä¹‹åå°±ä¸èƒ½æ›´æ”¹ä¸º `true` 
2. **`[[Enumerable]]`**: è¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ `for-in` å¾ªç¯è¿”å›ï¼Œé»˜è®¤ä¸º `true`
3. **`[[Writable]]`**: è¡¨ç¤ºå±æ€§å€¼æ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹ï¼Œé»˜è®¤ä¸º `true`
4. **`[[Value]]`**: åŒ…å«å±æ€§å®é™…çš„å€¼ï¼Œé»˜è®¤ä¸º `undefined`

å¯¹è±¡å­—é¢é‡ï¼š

```js
// åˆ™ [[Configurable]] & [[Enumerable]] & [[Writable]] éƒ½å°†æ˜¯é»˜è®¤å€¼ true
// [[Value]] å€¼åˆ™ä¸º 'Kobe'
let person = {
  name: 'Kobe'
}
```

å¦‚æœè¦ä¿®æ”¹å±æ€§çš„é»˜è®¤ç‰¹æ€§ï¼Œåˆ™éœ€è¦ä½¿ç”¨ä¸‹é¢æ–¹æ³•ï¼š**å¦‚æœä½¿ç”¨ä¸‹é¢æ–¹æ³•å®šä¹‰äº†éƒ¨åˆ†å±æ€§ï¼Œåˆ™æœªå®šä¹‰çš„é»˜è®¤ä¸º `false`**

- **`Object.defineProperty(o: any, p: PropertyKey, attributes: PropertyDescriptor & ThisType<any>): any;`**: å®šä¹‰å¯¹è±¡ä¸Šå•ä¸ªå±æ€§å€¼
- **`Object.defineProperties(o: any, properties: PropertyDescriptorMap & ThisType<any>): any;`**ï¼šåŒæ—¶å®šä¹‰å¯¹è±¡å¤šä¸ªå±æ€§å€¼

ç¤ºä¾‹ï¼š **âš ï¸éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ²¡æœ‰æ•ˆæœï¼›ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒæŠ›å‡ºé”™è¯¯**

```js

// 1. è®¾ç½® [[Writable]], æ˜¯å¦èƒ½ä¿®æ”¹å±æ€§
// å…¶ä½™æœªå®šä¹‰çš„ enumerable & configurable åˆ™é»˜è®¤ä¸º false
let person = {}
Object.defineProperty(person, 'name', {
  writable: false, // è¡¨ç¤ºä¸èƒ½å†ä¿®æ”¹
  value: 'Kobe'
})
// å°è¯•ä¿®æ”¹
person.name = 'James'

console.log(person.name) // 'Kobe' ä¸å˜


// 2. è®¾ç½® [[Configurable]]ï¼Œæ˜¯å¦èƒ½åˆ é™¤å±æ€§
let person = {}
Object.defineProperty(person, 'name', {
  configurable: false, // è¡¨ç¤ºä¸èƒ½åˆ é™¤
  value: 'Kobe'
})
delete person.name // æ²¡æœ‰æ•ˆæœ

// å°è¯•å°†å…¶å†ä¿®æ”¹ä¸º trueï¼ŒæŠ›å‡ºé”™è¯¯
Object.defineProperty(person, 'name', {
  configurable: true,
  value: 'Kobe'
})
```

> 2. è®¿é—®å™¨å±æ€§

å°±æ˜¯ **`Getter & Setter`**, æœ‰4ä¸ªç‰¹æ€§æè¿°å®ƒä»¬çš„è¡Œä¸ºï¼š

1. **`[[Configurable]]`**: è¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ `delete` åˆ é™¤å¹¶é‡æ–°å®šä¹‰ï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹å®ƒçš„ç‰¹æ€§ï¼Œä»¥åŠæ˜¯å¦å¯æŠŠå®ƒæ”¹ä¸ºæ•°æ®å±æ€§ï¼Œé»˜è®¤ä¸º `true`
2. **`[[Enumerable]]`**: è¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ `for-in` å¾ªç¯è¿”å›ï¼Œé»˜è®¤ä¸º `true`
3. **`[[Get]]`**: è¯»å–å±æ€§ï¼Œé»˜è®¤æ˜¯ `undefined`
4. **`[[Set]]`**: è®¾ç½®å±æ€§ï¼Œé»˜è®¤æ˜¯ `undefined`

ç¤ºä¾‹ï¼š

```js
let book = {
  year_: 2017, // ç§æœ‰å±æ€§ï¼ˆçº¦å®šä¿—æˆçš„å†™æ³•ï¼‰
  edition: 1
}
Object.defineProperty(book, 'year', {
  get() {
    return this.year_
  },
  set(newValue) {
    if (newValue > 2017) {
      this.year_ = newValue
      this.edition += newValue - 2017
    }
  }
})
```

ä½¿ç”¨ **`Object.defineProperties()`** å®šä¹‰å¤šä¸ªå±æ€§ï¼š

```js
let book = {}
Object.defineProperties(book, {
  year_: {
    value: 2017,
  },
  edition: {
    value: 1
  },
  get() {
    return this.year_
  },
  set(newValue) {
    if (newValue > 2017) {
      this.year_ = newValue
      this.edition += newValue - 2017
    }
  }
})
```

ä¸Šé¢çš„ **`year_ & edition`** å±æ€§æ²¡æœ‰å®šä¹‰ `configurable & enumerable & writable`, åˆ™å°†é»˜è®¤è®¾ç½®ä¸º `false`



## 2. è¯»å–å¯¹è±¡ä¸Šçš„å±æ€§

ä¸»è¦æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š

1. **`Object.getOwnPropertyDescriptor(o: any, p: PropertyKey): PropertyDescriptor | undefined;`**: è·å–æŒ‡å®šå±æ€§æè¿°ç¬¦
2. **`Object.getOwnPropertyDescriptors()`**ï¼šè·å–å¤šä¸ªå±æ€§æè¿°ç¬¦ï¼ˆES7ï¼‰

æ¯”å¦‚ä¸Šé¢çš„ `book` å¯¹è±¡ï¼š

```js
// è·å– 'year_' å±æ€§
let descriptor = Object.getOwnPropertyDescriptor(book, 'year_')

// descriptor å¦‚ä¸‹
{
  configurable: false,
  enumerable: false,
  writable: false,
  value: 2017
}

// è·å–å¤šä¸ªå±æ€§
let descriptors = Object.getOwnProertyDescriptors(book)

// descirptors
{
  edition: {
    configurable: false
		enumerable: false
		value: 1
		writable: false
  },
  get: {
    configurable: false
    enumerable: false
    value: undefined
    writable: false
  },
	set: {
    configurable: false
    enumerable: false
    value: undefined
    writable: false
  },
	year_: {
    configurable: false
    enumerable: false
    value: 2017
    writable: false
  }
}
```

## 3. åˆå¹¶å¯¹è±¡

ç›¸å…³ `Object`é™æ€ æ–¹æ³•ï¼š

1. **`Object.assign(target: object, ...sources: any[]): any;`**: å°†æ‰€æœ‰ `enumerable` å±æ€§æµ…æ‹·è´åˆ°ç›®æ ‡å¯¹è±¡
2. **`Object.is(value1: any, value2: any): boolean;`**: åˆ¤æ–­2ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ³¨æ„å’Œ `=== || ==` ä¹‹é—´çš„åŒºåˆ«

`Object` å®ä¾‹æ–¹æ³•:

1. **`hasOwnProperty(v: PropertyKey): boolean`**: å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªèº«å®šä¹‰çš„ï¼Œè€Œä¸æ˜¯åŸå‹é“¾ä¸Šçš„
2. **`propertyIsEnumerable(v: PropertyKey): boolean;`**: å±æ€§æ˜¯å¦å¯æšä¸¾



ç¤ºä¾‹ï¼š

```js
// Object.assign()
let dest = {}
let src = { id: 1, obj: { age: 10 }}
let result = Object.assign(dest, src)
console.log(result === dest)  // true

dest.obj.age = 20
console.log(src.obj.age) // 20 å› ä¸ºæµ…æ‹·è´
dest.hasOwnProperty('id') // true
dest.propertyIsEnumerable('id') // true
```

å¦‚æœå‡ºé”™ï¼Œæ²¡æœ‰å›æ»šï¼š

```js
let dest = { a: 1 }
let src = {
	a: 2,
	get b() {
		// Object.assign() åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ä¼šæŠ›å‡ºé”™è¯¯
		throw new Error()
	},
	c: 3
}
try {
	Object.assign(dest, src)
} catch(e) {}

console.log(dest)
// æœªå‡ºé”™å‰çš„ a è¢«ä¿®æ”¹
{
	a: 2
}
```

**æƒ³ç­‰æ€§æµ‹è¯•**ï¼š

```js
+0 === -0 // true
{} === {} // false
"2" === 2 // false
NaN === NaN // false
isNaN(NaN) // true

Object.is(+0, -0)  // false
Object.is({}, {})  // false
Object.is(NaN, NaN) // true
```



##  4. å¯¹è±¡è§£æ„

1.è§£æ„åœ¨å†…éƒ¨ä½¿ç”¨å‡½æ•° **`TOObject()`**(ä¸èƒ½åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­ç›´æ¥è®¿é—®è¿™ä¸ªå‡½æ•°) æŠŠæºæ•°æ®ç»“æ„è½¬æ¢ä¸ºå¯¹è±¡ï¼Œè¿™è¡¨ç¤ºåœ¨å¯¹è±¡è§£æ„çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ**åŸå§‹å€¼ä¼šè¢«å½“æˆå¯¹è±¡ï¼Œ å› æ­¤ `null & undefined` ä¸èƒ½è¢«è§£æ„ï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯**

```js
// åœ¨å¯¹è±¡è§£æ„çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ åŸå§‹ç±»å‹å½“ä½œå¯¹è±¡
let { length } = 'football'
console.log(length) // 6

let { constructor: c } = 4
console.log(c === Number) // true

// æŠ›å‡ºé”™è¯¯
let { _ } = null
let { _ } = undefined
```

**2.è§£æ„ä¸è¦æ±‚å˜é‡å¿…é¡»å£°æ˜åœ¨è¡¨è¾¾å¼ä¸­ï¼Œä½†æ˜¯ï¼Œå¦‚æœäº‹å…ˆå£°æ˜å˜é‡èµ‹å€¼ï¼Œåˆ™èµ‹å€¼è¡¨è¾¾å¼å¿…é¡»åŒ…å«åœ¨ä¸€å¯¹æ‹¬å·ä¸­ï¼š**

```js
let person = { age: 10, name: 'kobe' }

// æ–¹å¼1
// ç›´æ¥å£°æ˜åœ¨è¡¨è¾¾å¼ä¸­
let { age: personAge, name: personName } = person

// æ–¹å¼2
let personName, personAge // äº‹å…ˆå£°æ˜
// å¿…é¡»åŒ…å«åœ¨ä¸€å¯¹æ‹¬å·ä¸­
({age: personAge, name: personName} = person) 
```

3.è§£æ„å’Œ `Object.assign()` ä¸€æ ·ï¼Œå¦‚æœå‡ºé”™ï¼Œåˆ™ä¼šéƒ¨åˆ†è§£æ„ï¼Œ**ä¸ä¼šå›æ»š**

```js
let person = { age: 10, name: 'kobe' }

let personName, personAge, personBar

try {
	// person.foo æ˜¯ undefined è§£æ„æŠ›å‡ºé”™è¯¯
	({name: personName, foo: { bar: personBar }, age: personAge} = person)
} catch(err) {}

console.log(personName, personBar, personAge)
// éƒ¨åˆ†è§£æ„
kobe
undefined
undefined
```



## 5. åˆ›å»ºå¯¹è±¡

ES6å‡ºç°ä¹‹å‰æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼šï¼ˆJSä¸­çš„å‡½æ•°æ—¢å¯ä»¥ä½œä¸ºæ™®é€šå‡½æ•°ä¹Ÿå¯ä»¥ä½œä¸ºæ„é€ å‡½æ•°ï¼‰

1. å·¥å‚æ¨¡å¼ï¼šä½¿ç”¨å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œç¼ºç‚¹å°±æ˜¯ **æ— æ³•æ¨æ–­å¯¹è±¡ç±»å‹**

 	2. **æ„é€ å‡½æ•°**ï¼š ä½¿ç”¨ **`new`** æ“ä½œç¬¦ï¼Œè°ƒç”¨å‡½æ•°ï¼Œç¼ºç‚¹å°±æ˜¯ **å®šä¹‰åœ¨å…¶ä¸Šçš„æ–¹æ³•ï¼Œä¼šåœ¨æ¯ä¸ªå®ä¾‹ä¸Šéƒ½åˆ›å»ºä¸€éï¼Œæµªè´¹ç©ºé—´**
 	3. **åŸå‹æ¨¡å¼**ï¼šæ¯ä¸ªå‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ª **`prototype`** å¯¹è±¡ï¼Œå¯åŒ…å«å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªå¯¹è±¡éœ€é€šè¿‡æ„é€ å‡½æ•°åˆ›å»º



### 5.1 å·¥å‚æ¨¡å¼

å¤§è‡´æ–¹å¼ï¼š

```js
function createObject(name, age) {
  // 1.åˆ›å»ºå¯¹è±¡
	let o = new Object()
  // 2.åœ¨å¯¹è±¡ä¸Šæ·»åŠ å±æ€§å’Œæ–¹æ³•
	o.name = name
	o.age = age
	o.sayName = function() {
		console.log(this.name)
	}
  // è¿”å›å¯¹è±¡
	return o
}

// ä½¿ç”¨
let kobe = createObject('kobe', 24)
let james = createObject('james', 23)
```



### 5.2 æ„é€ å‡½æ•°

**æŒ‰ç…§è§„å®šï¼Œæ„é€ å‡½æ•°åé¦–å­—æ¯å¤§å†™ï¼Œä½¿ç”¨ `new` æ“ä½œç¬¦è°ƒç”¨**

```js
function Person(name, age) {
	this.name = name
	this.age = age
	this.sayName = function() { console.log(this.name) }
}
// ç­‰ä»·äº
let Person = function(name, age) {
	this.name = name
	this.age = age
	this.sayName = function() { console.log(this.name) }
}

let kobe = new Person('kobe', 24)
let james = new Person('james', 23)
```

å’Œå·¥å‚å‡½æ•°çš„åŒºåˆ«ï¼š

1. æ²¡æœ‰åˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡
2. å±æ€§å’Œæ–¹æ³•ç›´æ¥èµ‹å€¼ç»™ `this`
3. æ²¡æœ‰ `return`
4. å‡½æ•°åé¦–å­—æ¯å¤§å†™ï¼Œå¹¶ä½¿ç”¨ `new` è°ƒç”¨

è°ƒç”¨æ„é€ å‡½æ•°è¿‡ç¨‹å¦‚ä¸‹ï¼š

1. åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
2. è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„ **`[[prototype]]`** ç‰¹æ€§è¢«èµ‹å€¼ä¸ºæ„é€ å‡½æ•°çš„ `prototype` å±æ€§
3. æ„é€ å‡½æ•°å†…éƒ¨çš„ `this` è¢«èµ‹å€¼ä¸ºè¿™ä¸ªæ–°å¯¹è±¡ï¼ˆå³ `this`  æŒ‡å‘æ–°å¯¹è±¡ï¼‰
4. æ‰§è¡Œæ„é€ å‡½æ•°å†…éƒ¨çš„ä»£ç ï¼ˆç»™æ–°å¯¹è±¡æ·»åŠ å±æ€§ï¼‰
5. å¦‚æœæ„é€ å‡½æ•°è¿”å›éç©ºå¯¹è±¡ï¼Œ åˆ™è¿”å›è¯¥å¯¹è±¡ï¼›å¦åˆ™ï¼Œè¿”å›åˆšåˆ›å»ºçš„æ–°å¯¹è±¡

é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹ï¼Œæœ‰ä¸€ä¸ª **`constructor`** å±æ€§ï¼Œç”¨æ¥æ ‡è¯†å¯¹è±¡ç±»å‹ï¼šï¼ˆ**ä¸€èˆ¬ä½¿ç”¨ instanceof åˆ¤å®šç±»å‹**ï¼‰

```js
kobe.constructor === Person // true
james.constructor === Person // true

// instanceof
kobe instanceof Object // true
kobe instanceof Person // true
```



### 5.3 åŸå‹æ¨¡å¼ ğŸ¥•ğŸ¥•ğŸ¥•

JSåŸå‹ç¼–ç¨‹çš„åŸºæœ¬è§„åˆ™ï¼šï¼ˆæ¥è‡ªã€ŠJavascriptè®¾è®¡æ¨¡å¼å’Œå¼€å‘å®æˆ˜ã€‹ï¼‰

1. æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡
2. è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒ
3. å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŸå‹
4. å¦‚æœå¯¹è±¡æ— æ³•å“åº”æŸä¸ªè¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™å®ƒè‡ªå·±çš„åŸå‹

ä½¿ç”¨åŸå‹çš„å¥½å¤„æ˜¯ï¼Œåœ¨ä¸Šé¢å®šä¹‰çš„æ–¹æ³•å’Œå±æ€§å¯ä»¥è¢«å¯¹è±¡å®ä¾‹å…±äº«ï¼š

```js
function Person() {}

Person.prototype.name = 'Kobe'
Person.prototype.age = 24
Person.prototype.sayName = function() { console.log(this.name) }

let kobe = new Person()
kobe.sayName() // kobe
```

**ç†è§£åŸå‹**ï¼Œæœ‰3ä¸ªæ¦‚å¿µéœ€è¦åŒºåˆ†æ¸…æ¥šï¼š

1. æ„é€ å‡½æ•°ï¼Œæ¯”å¦‚ä¸Šé¢å£°æ˜çš„ **`Person`**
2. å®ä¾‹ï¼šä½¿ç”¨ `new` æ“ä½œç¬¦ä¿®é¥°çš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚ `let kobe = new Person()`, `kobe` å°±æ˜¯ `Person` çš„ä¸€ä¸ªå®ä¾‹
3. åŸå‹å¯¹è±¡ï¼Œå³ **`Person.prototype`**

è°ƒç”¨æ„é€ å‡½æ•°æœ‰å¦‚ä¸‹ç»“æœï¼š

1. å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ª **`prototype`** å±æ€§ï¼Œåªæƒ³åŸå‹å¯¹è±¡
2. åŸå‹å¯¹è±¡è‡ªåŠ¨è·å¾—ä¸€ä¸ª `constructor` å±æ€§ï¼ŒæŒ‡å›ä¸ä¹‹å…³è”çš„æ„é€ å‡½æ•°ï¼Œå³ `Person.prototype.constructor === Person`
3. å®ä¾‹æœ‰ä¸ªå†…éƒ¨å±æ€§ **`[[Prototype]]`** ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä¸€èˆ¬ä½¿ç”¨ **`__proto__`** è®¿é—® ï¼Œä¼šæŒ‡å‘åŸå‹å¯¹è±¡ï¼Œå³ **`kobe.__proto__ == Person.prototype`**

ç¤ºä¾‹ï¼š

```js
function Person() {}

// æœ‰å¦‚ä¸‹å…³ç³»
// 1. åŸå‹çš„constructorå±æ€§æŒ‡å‘ä¸ä¹‹å…³è”çš„æ„é€ å‡½æ•°
Person.prototype.construtor === Person

// 2. åŸå‹çš„[[prototype]] (ç”¨`__proto__`è¡¨ç¤º) æŒ‡å‘çˆ¶ç±»ï¼ˆè¿™é‡Œçˆ¶ç±»æ˜¯Objectï¼‰ çš„åŸå‹
Person.prototype.__proto__ === Object.prototype
// 3.  åŸå‹çš„[[prototype]] çš„ constructorå±æ€§æŒ‡å‘ä¸ä¹‹å…³è”çš„æ„é€ å‡½æ•°
Person.prototype.__proto__.constructor === Object

//
Person.prototype.__proto__.__proto__ === null
// ç­‰ä»·äº
Object.prototype.__proto__ === null

let kobe = new Person()
let james = new Person()
kobe.__proto__ === Person.prototype
jame.__proto === Person.prototype
kobe.__proto__ === jame.__proto // å®ä¾‹æŒ‡å‘ç›¸åŒçš„åŸå‹

kobe.__proto__.constructor === Person
/// å› ä¸º kobe.__proto__ === Person.prototype
/// æ‰€ä»¥ç­‰ä»·äº
Person.prototype.constructor === Person
```

<img src="images/ch08/1.æ„é€ å‡½æ•°&å®ä¾‹&åŸå‹.jpg" alt="1.æ„é€ å‡½æ•°&å®ä¾‹&åŸå‹" style="zoom:50%;" />

åŸå‹ç›¸å…³çš„æ–¹æ³•ï¼š

1. **`isPrototypeOf()`**: æ˜¯å¦æ˜¯æŸä¸ªå®ä¾‹çš„åŸå‹
2. **`Object.getPrototypeOf(instance)`**: è¿”å›instanceå†…éƒ¨ç‰¹æ€§ `[[Prototype]]`(`__proto__`) å€¼
3. **`Object.setPrototypeOf()`**: å‘å®ä¾‹çš„ç§æœ‰ç‰¹æ€§ `[[Prototype]]`(`__proto__`)  å†™å…¥ä¸€ä¸ªæ–°å€¼ï¼Œ **âš ï¸è¿™ä¸ªæ–¹æ³•å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œè¯·ä½¿ç”¨ `Object.create()` æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶æŒ‡å®šå…¶åŸå‹** ï¼ˆ`Object.create` æ˜¯ES5æ–¹æ³•ï¼‰

ç¤ºä¾‹ï¼š

```js
function Person() {}

Person.prototype.name = 'Kobe'
Person.prototype.age = 24
Person.prototype.sayName = function() { console.log(this.name) }

let kobe = new Person()

Person.prototype.isPrototypeOf(kobe) // true
Object.getPrototypeOf(kobe) === Person.prototype // true
Object.getPrototypeOf(kobe).name // 'kobe'

// æ…ç”¨ï¼Œå­˜åœ¨æ€§èƒ½é—®é¢˜
let biped = { legs: 2 }
let person = { name: 'Matt' }
// å°†bipedè®¾ç½®ä¸º person çš„åŸå‹
Object.setPrototypeOf(person, biped)
// åˆ™
person.legs // 2
Object.getPrototypeOf(person) === biped // true

// âœ¨âœ¨âœ¨ ä½¿ç”¨ Object.create() æ›¿æ¢ä¸Šé¢çš„æ–¹å¼ æ¨èä½¿ç”¨
let biped = { legs: 2 }
let person = Object.create(biped)
person.name = 'Matt'
```

âš ï¸âš ï¸âš ï¸Â â¶ï¼š

ä½¿ç”¨ä¸‹é¢æ–¹å¼ç»Ÿä¸€è®¾ç½®åŸå‹ï¼š

```js
function Person() {}

Person.prototype.name = 'Kobe'
Person.prototype.age = 24
Person.prototype.sayName = function() { console.log(this.name) }

// æ”¹å†™ä¸º
Person.prototype = {
	name: 'Kobe',
	age: 24,
	sayName() { console.log(this.name) }
}
```

**å­˜åœ¨çš„é—®é¢˜ï¼Œ è¿™æ ·å†™ä¹‹ååŸå‹ï¼ˆ`Person.prototype`ï¼‰è¢«è®¾ç½®ä¸ºä¸€ä¸ªé€šè¿‡å¯¹è±¡å­—é¢é‡åˆ›å»ºçš„æ–°å¯¹è±¡ï¼ŒåŸå‹ï¼ˆ`Person.prototype`ï¼‰çš„ `constructor` å±æ€§å°±ä¸å†æŒ‡å‘æ„é€ å‡½æ•°ï¼ˆ`Person`ï¼‰ã€‚å› ä¸ºåœ¨åˆ›å»ºæ„é€ å‡½æ•°æ—¶ï¼Œä¼šè‡ªåŠ¨ç»™åŸå‹çš„constructorå±æ€§èµ‹å€¼ï¼Œè€Œä¸Šé¢çš„å†™æ³•å®Œå…¨é‡å†™äº†é»˜è®¤çš„åŸå‹ï¼Œå› æ­¤constructorå±æ€§ä¹ŸæŒ‡å‘äº†å®Œå…¨ä¸åŒçš„æ–°å¯¹è±¡ï¼ˆ`Object` æ„é€ å‡½æ•°ï¼‰**

```js
let kobe = new Person()
kobe instanceof Object // true
kobe instanceof Person // true
kobe.__proto__.constructor === Person // false
kobe.__proto__.constructor === Object // true
kobe.constructor == Person // false
kobe.constructor == Object // true
```

å¦‚æœ `constructor` å€¼å¾ˆé‡è¦ï¼Œåˆ™å¯ä»¥åœ¨é‡å†™åŸå‹å¯¹è±¡æ—¶ä¸“é—¨è®¾ç½®ä¸€ä¸‹å®ƒçš„å€¼ï¼š

```js
function Person() {}

// åŸå‹æŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡å­—é¢é‡
Person.prototype = {
  constructor: Person, // ä¸“é—¨è®¾ç½®ä¸€ä¸‹å…¶æŒ‡å‘çš„æ„é€ å‡½æ•°
	name: 'Kobe',
	age: 24,
	sayName() { console.log(this.name) }
}

kobe instanceof Object // true
kobe instanceof Person // true
kobe.__proto__.constructor === Person // true
kobe.__proto__.constructor === Object // false
kobe.constructor == Person // true
kobe.constructor == Object // false
```

è¿™æ ·å¤„ç†çš„å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œ**`[[Enumerable]]`** å°†ä¼šè®¾ç½®ä¸º `true`, è€ŒåŸç”Ÿçš„ `constructor` é»˜è®¤æ˜¯ä¸å¯æšä¸¾çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ `Object.defineProperty()` è®¾ç½®è¿™ä¸ªå±æ€§ï¼š

```js
function Person() {}

// åŸå‹æŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡å­—é¢é‡
Person.prototype = {
	name: 'Kobe',
	age: 24,
	sayName() { console.log(this.name) }
}

Object.defineProperty(Person.prototype, 'constructor', {
	enumerable: false,
	value: Person
})
```



âš ï¸âš ï¸âš ï¸ â‹ï¼šåŸå‹çš„åŠ¨æ€æ€§

ä¸€èˆ¬å…ˆåˆ›å»ºå®ä¾‹ï¼Œå†åœ¨åŸå‹ä¸Šå®šä¹‰ä¸€äº›å±æ€§å’Œæ–¹æ³•æ˜¯æ²¡é—®é¢˜çš„ï¼š

```js
function Person() {}
let kobe = new Person()

Person.prototype.sayHi = function() { console.log('hi') }
kobe.sayHi() // OK
```

ä½†æ˜¯**å¦‚æœé‡å†™æ•´ä¸ªåŸå‹åˆ™ä¼šå‡ºç°é—®é¢˜ï¼Œå®ä¾‹çš„ `[[Prototype]]` æŒ‡é’ˆæ˜¯åœ¨è°ƒç”¨æ„é€ å‡½æ•°æ—¶è‡ªåŠ¨èµ‹å€¼çš„ï¼Œè¿™ä¸ªæŒ‡é’ˆå³ä½¿æŠŠåŸå‹ä¿®æ”¹ä¸ºä¸åŒçš„å¯¹è±¡ä¹Ÿä¸ä¼šå˜**

```js
function Person() {}
let kobe = new Person()

// åŸå‹æŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡å­—é¢é‡
Person.prototype = {
  constructor: Person, // ä¸“é—¨è®¾ç½®ä¸€ä¸‹å…¶æŒ‡å‘çš„æ„é€ å‡½æ•°
	name: 'Kobe',
	age: 24,
	sayName() { console.log(this.name) }
}

kobe.sayHi() // é”™è¯¯
```



<img src="images/ch08/2.å®ä¾‹æŒ‡å‘æ—§çš„åŸå‹.jpg" alt="2.å®ä¾‹æŒ‡å‘æ—§çš„åŸå‹" style="zoom:50%;" />



### 5.4 Objectä¸Šçš„ä¸€äº›å…¶å®ƒæ–¹æ³•

1. **`in`** æ“ä½œç¬¦ï¼Œ å¯¹è±¡æˆ–å…¶åŸå‹é“¾ä¸Šæ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§
2. **`Object.keys(someObject)`**: æšä¸¾å¯¹è±¡ä¸Šçš„keys
3. **`someObject.hasOwnProperty(someProperty)`**: å¯¹è±¡å®ä¾‹è‡ªèº«æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§
4. **`Object.getOwnPropertyNames()`**: åˆ—ä¸¾å‡ºæ‰€æœ‰çš„å®ä¾‹å±æ€§,æ— è®ºæ˜¯å¦å¯æšä¸¾
5. **`Object.getOwnPropertySymbols()`**ï¼šåˆ—ä¸¾å‡º `Symbol` ä½œä¸ºkeysçš„keys

ç¤ºä¾‹ï¼š

```js
function Person() {}

Person.prototype.name = 'Kobe'
Person.prototype.age = 24
Person.prototype.sayName = function() { console.log(this.name) }

let kobe = new Person()

console.log('name' in kobe) // true
console.log(kobe.hasOwnProperty('age')) // true
console.log(Object.keys(Person.prototype)) // ["name", "age", "sayName"]
console.log(Object.getOwnPropertyNames(Person.prototype))
// constructor ä¸å¯æšä¸¾å±æ€§ä¹Ÿè¢«åˆ—ä¸¾å‡ºæ¥äº†
// ["constructor", "name", "age", "sayName"]

/// Object.getOwnPropertySymbols()
let k1 = Symbol('k1')
let k2 = Symbol('k2')
let o = {
  // [k1] è®¡ç®—å±æ€§çš„å†™æ³•
  [k1]: k1,
  [k2]: k2,
  name: 'jj'
}
Object.getOwnPropertyNames(o) // ['name']
Object.getOwnPropertySymbols(o) // [Symbol(k1), Symbol(k2)]
```

**å±æ€§æšä¸¾é¡ºåº**ï¼š

1. **`for-in & Object.keys()`** é¡ºåºä¸ç¡®å®š
2. **`Object.getOwnPropertyNames() & Object.getOwnPropertySymbols() & Object.assign()`** å…ˆå‡åºæšä¸¾æ•°å€¼é”®ï¼Œç„¶åæ’å…¥æšä¸¾å­—ç¬¦ä¸²å’ŒSymbolé”®



## 6. ç»§æ‰¿

ES5ä¹‹å‰çš„å‡ ç§æ–¹å¼ï¼š

1. åŸå‹é“¾æ–¹å¼ï¼Œç¼ºç‚¹æ˜¯åŸå‹ä¸­åŒ…å«å¼•ç”¨å€¼ä¼šåœ¨æ‰€æœ‰å®ä¾‹é—´å…±äº«
2. ç›—ç”¨æ„é€ å™¨å‡½æ•°ï¼Œå³å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼ŒåŸç†æ˜¯å°†çˆ¶ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•åœ¨æ¯ä¸ªå­ç±»å®ä¾‹ä¸­æ‹·è´ä¸€ä»½ï¼Œç¼ºç‚¹ï¼šå¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰æ–¹æ³•ï¼Œå‡½æ•°ä¸èƒ½å¤ç”¨ï¼Œå­ç±»ä¸èƒ½è®¿é—®çˆ¶ç±»åŸå‹ä¸Šå®šä¹‰çš„æ–¹æ³•
3. ç»„åˆç»§æ‰¿ï¼šç»¼åˆåŸå‹é“¾å’Œç›—ç”¨æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åŸå‹é“¾ç»§æ‰¿åŸå‹ä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼Œé€šè¿‡ç›—ç”¨æ„é€ å‡½æ•°ç»§æ‰¿å®ä¾‹å±æ€§ï¼Œç¼ºç‚¹ï¼šéœ€è¦è°ƒç”¨2éçˆ¶ç±»æ„é€ å™¨ï¼ŒæŸå¤±æ€§èƒ½
4. åŸå‹é“¾ç»§æ‰¿ï¼šç±»ä¼¼äº `Object.create()` æ–¹æ³•ï¼Œç¼ºç‚¹ï¼šå¼•ç”¨å€¼ä¼šåœ¨æ‰€æœ‰å®ä¾‹é—´å…±äº«ï¼ŒåŒåŸå‹é“¾æ–¹å¼
5. å¯„ç”Ÿå¼ç»§æ‰¿ï¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶ååœ¨å¯¹è±¡ä¸Šæ‰©å±•å±æ€§å’Œæ–¹æ³•ï¼Œç¼ºç‚¹æ˜¯éš¾ä»¥å¤ç”¨
6. å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿ï¼š**æ¨èğŸŒ¹** 



### 6.1 åŸå‹é“¾æ–¹å¼

âœ¨âœ¨âœ¨ ä¸‹é¢è¿™æ®µè¯æ¥è‡ª ã€ŠJavascriptè®¾è®¡æ¨¡å¼å’Œå¼€å‘å®æˆ˜ã€‹:

- **å½“å¯¹è±¡aéœ€è¦å€Ÿç”¨å¯¹è±¡bçš„èƒ½åŠ›æ—¶ï¼Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„æŠŠå¯¹è±¡açš„æ„é€ å™¨çš„åŸå‹æŒ‡å‘bï¼Œä»è€Œè¾¾åˆ°ç»§æ‰¿æ•ˆæœ**

å³ï¼š

```js
function SuperType() {
  this.property = true
}
SuperType.prototype.getSuperValue = function() {
  return this.property
}

function SubType() {
  this.subproperty = false
}

/// 
// âœ¨âœ¨âœ¨ å½“å¯¹è±¡aéœ€è¦å€Ÿç”¨å¯¹è±¡bçš„èƒ½åŠ›æ—¶ï¼Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„æŠŠå¯¹è±¡açš„æ„é€ å™¨çš„åŸå‹æŒ‡å‘bï¼Œä»è€Œè¾¾åˆ°ç»§æ‰¿æ•ˆæœ
// var obj = {name: 'kl'}
// var A = function() {}
// A.prototype = obj
// var a = new A()
// console.log(a.name) // kl
///

// å­ç±»åŸå‹æŒ‡å‘ SuperType
// ç»§æ‰¿ SuperType
SubType.prototype = new SuperType()
SubType.prototype.getSubValue = function() {
  return this.subproperty
} 
let instance = new SubType()
// è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•
instance.getSuperValue() // true
```

è¯·åŸå‹é“¾å…³ç³»å¦‚ä¸‹ï¼š

<img src="images/ch08/3.åŸå‹é“¾ç»§æ‰¿.jpg" alt="3.åŸå‹é“¾ç»§æ‰¿" style="zoom:50%;" />



### 6.2 ç›—ç”¨æ„é€ å™¨

```js
function SuperType(name) {
  this.name = name
}

function SubType() {
  // ç»§æ‰¿SuperType å¹¶ä¼ å‚
  SuperType.call(this, 'Nicholas')
  
  // å®ä¾‹å±æ€§
  this.age = 29
}
```



### 6.3 ç»„åˆç»§æ‰¿

åŸå‹é“¾+ç›—ç”¨æ„é€ å™¨ ç»“åˆ

```js
function SuperType(name) {
  this.name = name
  this.numbers = [1, 2]
}

SuperType.prototype.sayName = function() {
  console.log(this.name)
}

function SubType(name, age) {
  SuperType.call(this, name)  // è°ƒç”¨2æ¬¡
  this.age = age
}

// ç»§æ‰¿æ–¹æ³•
SubType.prototype = new SuperType() // è°ƒç”¨1æ¬¡

SubType.prototype.sayAge =  function() {
  console.log(this.age)
}

let instance1 = new SubType('kobe', 24)
instance1.numbers.push(3)
console.log(instance1.numbers) // [1, 2, 3]
instance1.sayName() 'kobe'

let instance2 = new SubType('kobe', 24)
console.log(instance2.numbers) // [1, 2]
instance1.sayName() 'kobe'
```

ç¼ºç‚¹æ˜¯è°ƒç”¨2æ¬¡çˆ¶ç±»æ„é€ å™¨



### 6.4 åŸå‹å¼ç»§æ‰¿

åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ„é€ å‡½æ•°ï¼Œå°†ä¼ å…¥çš„å¯¹è±¡èµ‹å€¼ç»™è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹ï¼Œç„¶åè¿”å›å®ä¾‹ï¼Œ **ES5 å¯¹è¿™ç§æ–¹å¼è¿›è¡Œäº†å°è£…ï¼Œå³ `Object.create()`**

```js
function object(o) {
  function F() {} // ä¸´æ—¶æ„é€ å‡½æ•°
  F.prototype = o // å¯¹è±¡èµ‹å€¼ç»™ä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹
  return new F() // è¿”å›å®ä¾‹
}
```

ä½¿ç”¨ï¼š

```js
let person = {
  name: 'kobe',
  numbers: [1, 2]
}
let person1 = object(person)
person1.name = 'A'
person1.numbers.push(3)

let person2 = object(person)
person1.name = 'B'
person1.numbers.push(4)

// å¼•ç”¨ç±»å‹ä¼šè¢«å®ä¾‹é—´å…±äº«
console.log(person.numbers) // [1, 2, 3, 4]
```



### 6.5 å¯„ç”Ÿå¼ç»§æ‰¿

å’ŒåŸå‹å¼ç»§æ‰¿æ¯”è¾ƒç±»ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ªå®ç°ç»§æ‰¿çš„å‡½æ•°ï¼Œä»¥æŸç§æ–¹å¼å¢å¼ºå¯¹è±¡ï¼Œç„¶åè¿”å›è¯¥å¯¹è±¡

```js
function object(o) {
  function F() {} // ä¸´æ—¶æ„é€ å‡½æ•°
  F.prototype = o // å¯¹è±¡èµ‹å€¼ç»™ä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹
  return new F() // è¿”å›å®ä¾‹
}

function createObject(original) {
  let clone = object(original) // åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡
  // å¢å¼ºå¯¹è±¡
  clone.sayHi = function() { console.log('hi') }
  return clone
}
```



### 6.6 å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿ğŸ˜€ğŸ˜€ğŸ˜€

 **æ¨èä½¿ç”¨**

```js
function object(o) {
  function F() {} // ä¸´æ—¶æ„é€ å‡½æ•°
  F.prototype = o // å¯¹è±¡èµ‹å€¼ç»™ä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹
  return new F() // è¿”å›å®ä¾‹
}

function inheritPrototype(subType, superType) {
  let prototype = object(superType.prototype) // åˆ›å»ºå¯¹è±¡ åˆ›å»ºçˆ¶ç±»å‰¯æœ¬
  prototype.constructor = subType // å¢å¼ºå¯¹è±¡ï¼Œ ç»“å±€é‡å†™åŸå‹å¯¼è‡´é»˜è®¤constructorä¸¢å¤±é—®é¢˜
  subType.prototype = prototype // èµ‹å€¼å¯¹è±¡
}
```

ä½¿ç”¨ï¼š

```js
function SuperType(name) {
	this.name = name
	this.numbers = [1, 2]
}

SuperType.prototype.sayName = function() {
  console.log(this.name)
}

function SubType(name, age) {
  SuperType.call(this, name)
  this.age = age
}

// ç»§æ‰¿æ–¹æ³•
inheritPrototype(SubType, SuperType)

SubType.prototype.sayAge =  function() {
  console.log(this.age)
}
```



## 7. ç±»

ç±»åªæ˜¯å‡½æ•°çš„è¯­æ³•ç³–ã€‚



### 7.1 åŸå‹æ–¹æ³•å’Œè®¿é—®å™¨åŠé™æ€æ–¹æ³•

```js
const symbolKey = Symbol('symbolKey')

class Person {
  constructor() {
    // æ·»åŠ åˆ°this çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šå­˜åœ¨äºä¸åŒçš„å®ä¾‹ä¸Š
    this.locate = () => console.log('instance method')
  }
  
  locate() {
    console.log('method on prototype')
  }
  
  [symbolKey]() {
    console.log('method on prototype symbolKey')
  }
  
  static locate() {
    console.log('static method')
  }
  
  // è®¾ç½®è®¿é—®å™¨
  get name() {
    return this.name_
  }
  
  set name(newName) {
    this.name_ = newName
  }
}

let p = new Person()
p.locate() // instance method
p.prototype.locate() // method on prototype
Person.locate() // static method
```



### 7.2 è¿­ä»£å™¨å’Œç”Ÿæˆå™¨æ–¹æ³•

æ”¯æŒåœ¨åŸå‹å’Œç±»æœ¬èº«å®šä¹‰ç”Ÿæˆå™¨æ–¹æ³•ï¼š

```js
class Person {
	// åœ¨åŸå‹ä¸Šå®šä¹‰ç”Ÿæˆå™¨æ–¹æ³•
	*createNamesIterator() {
		yield 'kobe'
		yield 'james'
	}
	
	// åœ¨ç±»ä¸Šå®šä¹‰ç”Ÿæˆå™¨æ–¹æ³•
	static *createNumsIterator() {
		yield 1
		yield 2
	}
}

let numIter = Person.createNumsIterator()
numIter.next().value // 1
numIter.next().value // 2
numIter.next().value  // undefined

let p = new Person()
let namesIter = p.createNamesIterator()
namesIter.next().value // kobe
namesIter.next().value // james
namesIter.next().value  // undefined
```

**ğŸ¤©ğŸ¤©ğŸ¤©: å¯ä»¥æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„è¿­ä»£å™¨ï¼ŒæŠŠç±»å®ä¾‹å˜ä¸ºå¯è¿­ä»£å¯¹è±¡**ï¼š

```js
class Person {
	constructor() {
    this.names = ['jane', 'lily']
  }
  
  *[Symbol.iterator]() {
    yield *this.names.entries()
  }
}

let p = new Person()
for (let [idx, name] of p) {
  console.log(name)
}
// æ‰“å°
jane
lily
```

æˆ–è€…è¿”å›è¿­ä»£å™¨å®ä¾‹ï¼š

```js
class Person {
	constructor() {
    this.names = ['jane', 'lily']
  }
  
  [Symbol.iterator]() {
    yield this.names.entries()
  }
}

let p = new Person()
for (let [idx, name] of p) {
  console.log(name)
}
```



### 7.3 ç»§æ‰¿

ä¸è¦åœ¨è°ƒç”¨ `super()` å‰ä½¿ç”¨ `this`:  å› ä¸º `super()` ä¼šè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œå¹¶å°†è¿”å›çš„å®ä¾‹èµ‹å€¼ç»™ `this`

```js
class Vihicle {}

class Bus extends Vihicle {
  constructor() {
    console.log(this)
  }
}

new Bus() 
// ReferenceError: Must call super constructor in derived class 
// before accessing 'this' or returning form derived constructor
```



### 7.4 ğŸ¤©ğŸ¤©ğŸ¤© æŠ½è±¡åŸºç±»

è™½ç„¶jsæ²¡æœ‰å®šä¹‰è¿™ç§è¯­æ³•ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ **`new.target`** æ¥å®ç°ã€‚`new.target` ä¿å­˜é€šè¿‡newæ“ä½œç¬¦è°ƒç”¨çš„ç±»æˆ–å‡½æ•°ã€‚é€šè¿‡å®ä¾‹åŒ–æ—¶æ£€æµ‹ `new.target` æ˜¯ä¸æ˜¯æŠ½è±¡ç±»ï¼Œå¯ä»¥é˜»æ­¢å¯¹æŠ½è±¡ç±»è¿›è¡Œå®ä¾‹åŒ–â€œ

```js
// æ¨¡æ‹ŸæŠ½è±¡ç±»
class Vihicle {
	constructor() {
    console.log(new.target)
    if (new.target === Vihicle) {
      throw new Error('Vihicle is abstract class, cannot be directly instantiated')
    }
  }
}

class Bus extends Vihicle {}

new Bus() // ok
new Vihicle() // Error Vihicle is abstract class, cannot be directly instantiated
```

**è¿˜å¯ä»¥è¦æ±‚å­ç±»å¿…é¡»å®šä¹‰æŸä¸ªæ–¹æ³•ï¼šå› ä¸ºåŸå‹æ–¹æ³•åœ¨è°ƒç”¨ç±»æ„é€ å‡½æ•°ä¹‹å‰å°±å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ `this` å…³é”®è¯æ¥æ£€æŸ¥ç›¸åº”çš„æ–¹æ³•**

```js
class Vihicle {
	constructor() {
    console.log(new.target)
    if (new.target === Vihicle) {
      throw new Error('Vihicle is abstract class, cannot be directly instantiated')
    }
    
    // å¦‚æœå­ç±»åŸå‹ä¸Šä¸å­˜åœ¨è¿™ä¸ªæ–¹æ³• åˆ™æŠ›å‡ºé”™è¯¯
    if (!this.foo) {
      throw new Error('Sub class must define foo()')
    }
  }
}

class Bus extends Vihicle {
  foo() {}
}

class Van extends Vihicle {}

new Bus() // OK
new Van() // Error: Sub class must define foo()
```



### 7.5 ğŸ¤©ğŸ¤©ğŸ¤©MixinåŠŸèƒ½

ä¸€èˆ¬ç°åœ¨é€šè¿‡ç»„åˆæ¨¡å¼å°†å¤šä¸ªåŠŸèƒ½ç»„åˆèµ·æ¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ï¼Œ **ç»„åˆèƒœè¿‡ç»§æ‰¿**ã€‚ä½†æ˜¯äº†è§£ä¸€ä¸‹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåå¤„

```js
// C ç»§æ‰¿ B, B ç»§æ‰¿ A, A ç»§æ‰¿ Vihicle
class Vihicle {}

let AMixin = (SuperClass) => class extends SuperClass {
  foo() { console.log('A') }
}

let BMixin = (SuperClass) => class extends SuperClass {
  bar() { console.log('B') }
}

let CMixin = (SuperClass) => class extends SuperClass {
  zoo() { console.log('C') }
}

class Bus extends CMixin(BMixin(AMixin(Vihicle))) {}

let b = new Bus()
b.foo()
b.bar()
b.zoo()
```

è¿˜å¯ä»¥å°è£…ä¸€ä¸‹ï¼š

```js
function mix(BaseClass, ...Mixins) {
	return Mixins.reduce((acc, curr) => curr(acc), BaseClass)
}

class Bus extends mix(Vihicle, CMixin, BMixin, AMixin)
```



2020å¹´12æœˆ15æ—¥ 23:58:19