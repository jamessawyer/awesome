**ç­–ç•¥æ¨¡å¼** æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å®ƒèƒ½è®©ä½ å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œ å¹¶å°†æ¯ç§ç®—æ³•åˆ†åˆ«æ”¾å…¥ç‹¬ç«‹çš„ç±»ä¸­ï¼Œ ä»¥ä½¿ç®—æ³•çš„å¯¹è±¡èƒ½å¤Ÿç›¸äº’æ›¿æ¢ã€‚

ä¼˜ç‚¹ï¼š

1. å¯åœ¨è¿è¡Œæ—¶åˆ‡æ¢ç®—æ³•
2. å°†ç®—æ³•çš„å®ç°å’Œç®—æ³•çš„ä½¿ç”¨éš”ç¦»å¼€æ¥
3. å¯ä»¥ä½¿ç”¨ç»„åˆä»£æ›¿ç»§æ‰¿ï¼ˆç»„åˆä¼˜äºç»§æ‰¿ï¼‰ï¼Œç­–ç•¥æ¨¡å¼åˆ©ç”¨ç»„åˆï¼Œå§”æ‰˜å’Œå¤šæ€ç­‰æŠ€æœ¯å’Œæ€æƒ³ï¼Œå¯æœ‰æ•ˆé¿å…å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥
4. å¼€é—­åŸåˆ™ï¼šæ— éœ€å¯¹ä¸Šä¸‹æ–‡ä¿®æ”¹å³å¯æ·»åŠ æ–°çš„ç­–ç•¥

ç¼ºç‚¹ï¼š

1. å®¢æˆ·ç«¯éœ€è¦çŸ¥é“æ¯ä¸€ç§ç®—æ³•çš„å«ä¹‰
2. ç°ä»£è¯­è¨€æ”¯æŒä¼ å…¥å‡½æ•°ä½œä¸ºå‚æ•°çš„æ–¹å¼ä¼ é€’ç®—æ³•ï¼Œå¯å‡å°‘æ¥å£å’Œç±»çš„æ•°é‡

<img src="images/ç­–ç•¥æ¨¡å¼.jpg" alt="ç­–ç•¥æ¨¡å¼" style="zoom:50%;" />

ä½¿ç”¨åœºæ™¯ï¼š

1. å½“ä½ æƒ³ä½¿ç”¨å¯¹è±¡ä¸­å„ç§ä¸åŒçš„ç®—æ³•å˜ä½“ï¼Œå¹¶å¸Œæœ›èƒ½åœ¨è¿è¡Œæ—¶åˆ‡æ¢ç®—æ³•æ—¶ï¼Œå¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼
2. å½“ä½ æœ‰è®¸å¤šä»…åœ¨æ‰§è¡ŒæŸäº›è¡Œä¸ºæ—¶ç•¥æœ‰ä¸åŒçš„ç›¸ä¼¼ç±»æ—¶ï¼Œå¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼
3. å½“ç±»ä¸­ä½¿ç”¨äº†å¤æ‚æ¡ä»¶è¿ç®—ç¬¦ä»¥åœ¨åŒä¸€ç®—æ³•çš„ä¸åŒå˜ä½“ä¸­åˆ‡æ¢æ—¶ï¼Œå¯ä½¿ç”¨è¯¥æ¨¡å¼

æ¯”å¦‚å‘æ”¾å¥–é‡‘æœ‰3ç§æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å¤šä¸ª `if` è¯­å¥è¿›è¡Œåˆ‡æ¢ï¼š

```js
/**
 * level: å¥–é‡‘çš„ç•Œåˆ«
 * salary: è–ªæ°´
 */
var calculateBonus = function(level, salary) {
  // å¤šä¸ªç®—æ³•åˆ†æ”¯çš„æƒ…å†µ å¯ä»¥è€ƒè™‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼
  if (level === 'S') return salary * 4 // Sçº§åˆ«çš„è¡¨ç° å·¥èµ„ * 4 ä½œä¸ºå¥–åŠ±
  if (level === 'A') return salary * 3 
  if (level === 'B') return salary * 2 
}

calculateBonus('S', 4000) // 16000
calculateBonus('A', 2000) // 6000
```

ä½¿ç”¨ä¼ ç»Ÿçš„ç­–ç•¥æ¨¡å¼æ–¹å¼å°†ç®—æ³•å’Œä¸Šä¸‹æ–‡è¿›è¡Œåˆ†ç¦»ï¼š

```js
// ç®—æ³•ç±»
class LevelS {
  calculate(salary) {
    return salary * 4
  }
}

class LevelA {
  calculate(salary) {
    return salary * 3
  }
}

class LevelB {
  calculate(salary) {
    return salary * 2
  }
}

// ä¸Šä¸‹æ–‡
class Bonus {
  constructor(salary) {
    this.salary = salary
    this.strategy = null
  }
  
  // è®¾ç½®ç­–ç•¥
  setStrategy(strategy) {
    this.strategy = strategy
  }
  
  calculate() {
    // ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥è®¡ç®—å¥–é‡‘
    this.strategy.calculate(this.salary)
  }
}

// Clientä»£ç 
var bonus = new Bonus(10000)

bonus.setStrategy(new LevelS()) // è®¾ç½®ç­–ç•¥ä¸º LevelS
bonus.calculate() // ä½¿ç”¨ç®—æ³•è®¡ç®—å¥–é‡‘ ä¸º 40000

// åŠ¨æ€çš„æ›´æ¢ç®—æ³•
bonus.setStrategy(new LevelB()) // å°†ç­–ç•¥åŠ¨æ€çš„è®¾ç½®ä¸º LevelB
bonus.calculate() // ä½¿ç”¨ç®—æ³•è®¡ç®—å¥–é‡‘ ä¸º 20000
```

é™¤äº†æ‰€æœ‰è¯­è¨€é€šç”¨çš„ä¼ ç»Ÿå†™æ³•å¤–ï¼ŒJSè¿˜æœ‰ä»¥ä¸‹å‡ ç§å†™æ³•ï¼š



## 1. JSå¯¹è±¡æ–¹å¼çš„ç­–ç•¥æ¨¡å¼

å› ä¸ºJSä¸­ï¼Œå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„ç­–ç•¥éƒ½æ”¾åœ¨ä¸€ä¸ªå¤§çš„å¯¹è±¡ä¸­ï¼Œå› æ­¤ä¸Šé¢çš„å†™æ³•å¯ä»¥å†™ä¸ºï¼š

```js
const strategies = {
  S: salary => salary * 4,
  A: salary => salary * 3,
  B: salary => salary * 2
}

const calculateBonus = (level, salary) => strateies[level](slary)

// Client
calculateBonus('S', 10000) // 40000
calculateBonus('A', 10000) // 30000
```



## 2. å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘

JSä¸­å¯ä»¥å°†å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›å€¼æ¥ä½¿ç”¨ï¼Œå› æ­¤ä¸Šé¢çš„jsè¯­è¨€çš„åŠ¨æ€æ€§ï¼Œå¯ä»¥å°†ä¸Šé¢çš„ä¾‹å­æ”¹å†™ä¸ºï¼š

```js
const S = salary => salary * 4
const A = salary => salary * 3
const B = salary => salary * 2

// å°†ç®—æ³•ç›´æ¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ å…¥
const calculateBonus = (calculate, salary) => calculate(salary)

calculateBonus(S, 10000) // 40000
calculateBonus(B, 10000) // 20000
```

## 3. âœ¨âœ¨âœ¨æ›´å¹¿ä¹‰çš„ç®—æ³•

ç­–ç•¥æ¨¡å¼é™¤äº†å°è£…ä¸€ç³»åˆ—ç®—æ³•å¤–ï¼Œè¿˜å¯ä»¥ç”¨æ¥å°è£…ä¸€ç³»åˆ—çš„ **ä¸šåŠ¡è§„åˆ™**ã€‚

æ¯”å¦‚ä¸‹é¢çš„è¡¨å•éªŒè¯ï¼š

1. ç”¨æˆ·åä¸èƒ½ä¸ºç©º
2. å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½
3. æ‰‹æœºå·ç å¿…é¡»ç¬¦åˆæ ¼å¼

ä¸€ä¸ªè¡¨å•ç»„ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªè§„åˆ™ï¼Œhtmlå¦‚ä¸‹ï¼š

```html
<form action="/something" id="form" method="post">
  ç”¨æˆ·åï¼š<input type="text" name="username" />
  å¯†ç ï¼š<input type="password" name="password" />
  æ‰‹æœºå·ï¼š<input type="text" name="phone" />
</form>
```

ä¸€èˆ¬çš„éªŒè¯é€»è¾‘ï¼š

```js
const form = document.getElementById('form')
form.onsubmit = function() {
  if (form.username.value === '') {
    console.log('ç”¨æˆ·åä¸èƒ½ä¸ºç©º')
    return false
  }
  
  if (form.password.value.length < 6) {
    console.log('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½')
    return false
  }
  
  if (!/(^1[3|5|8][0-9]{9}$)/.test(form.phone.value)) {
    console.log('æ‰‹æœºæ ¼å¼ä¸æ­£ç¡®')
    return false
  }
}
```

è¿™æ ·å†™è™½ç„¶æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ï¼š

1. `if-else` è¯­å¥å¤ªå¤š
2. ç¼ºä¹å¼¹æ€§ï¼Œå¦‚æœè¦å°†å¯†ç çš„é•¿åº¦ä¿®æ”¹ä¸º8ä½ï¼Œåˆ™éœ€è¦æ›´æ”¹ `form.onsubmit` å†…éƒ¨å®ç°ï¼Œä¸ç¬¦åˆå¼€é—­åŸåˆ™
3. ç®—æ³•çš„å¤ç”¨æ€§å·®ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªè¡¨å•ï¼Œéœ€è¦ç±»ä¼¼çš„éªŒè¯ï¼Œåˆ™éœ€è¦å°†è¿™ä¸€å¥—é€»è¾‘å†å†™ä¸€é



ä¸‹é¢ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ”¹å†™ä¸Šé¢çš„ä¸šåŠ¡é€»è¾‘ï¼š

```js
// ç­–ç•¥å¯¹è±¡
const strategies = {
  isNotEmpty: (value, errorMsg) => {
    if (value === '') return errorMsg
	},
  minLength: (value, length, errorMsg) => {
    if (value.length < length) return errorMsg
  },
  isMobile: (value, errorMsg) => {
    if (!/(^1[3|5|8][0-9]{9}$)/.test(value)) return errorMsg
  }
}

// Validatorç±»
class Validator {
  constructor() {
    this.cache = []
  }
  
  add(dom, rules) {
    let self = this
    for (let i = 0, rule; rule = rules[i++];) {
      (function(rule) {
        const strategyAry = rule.strategy.split(':') // æŠŠ strategy å’Œ å‚æ•°åˆ†å¼€
        const errorMsg = rule.errorMsg
        
        self.cache.push(function() { // æŠŠæ ¡éªŒçš„æ­¥éª¤ç”¨ç©ºå‡½æ•°åŒ…è£…èµ·æ¥ï¼Œå¹¶æ”¾å…¥cacheä¸­
          const strategy = strategyAry.shift() // ç”¨æˆ·é€‰æ‹©çš„ç®—æ³•
          strategyAry.unshift(dom.value) // æ·»åŠ domä¸­å¯¹åº”çš„valueåˆ°å‚æ•°åˆ—è¡¨ä¸­
          strategyAry.push(errorMsg) // æŠŠerrorMsgæ·»åŠ åˆ°å‚æ•°åˆ—è¡¨ä¸­
         	return strategies[strategy].apply(dom, strategyAry)
        })
      })(rule)
    }
  }
  
  start() {
    for (let i = 0, validatorFunc; validatorFunc = this.cache[i++];) {
      const errorMsg = validatorFunc()
      if (errorMsg) {
        return errorMsg
      }
    }
  }
}


// å®¢æˆ·ç«¯ä»£ç 
const form = document.getElementById('form')

const validateFunc =  function() {
  const validator = new Validator()
  
  // éªŒè¯é€»è¾‘
  validator.add(form.username, [
    {
      strategy: 'isNotEmpty',
      errorMsg: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º'
    },
    {
      strategy: 'minLength:4', // åŒ…å«ç­–ç•¥å’Œç­–ç•¥ä¸­çš„å‚æ•° ç”¨ç”¨ `:` éš”å¼€
      errorMsg: 'ç”¨æˆ·åä¸èƒ½å°‘äº4ä½'
    }
  ])
  
  validator.add(form.password, [
    {
      strategy: 'minLength:6', // åŒ…å«ç­–ç•¥å’Œç­–ç•¥ä¸­çš„å‚æ•° ç”¨ç”¨ `:` éš”å¼€
      errorMsg: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½'
    }
  ])
  
  validator.add(form.phone, [
    {
      strategy: 'isMobile', // åŒ…å«ç­–ç•¥å’Œç­–ç•¥ä¸­çš„å‚æ•° ç”¨ç”¨ `:` éš”å¼€
      errorMsg: 'æ‰‹æœºæ ¼å¼ä¸æ­£ç¡®'
    }
  ])
  
  const errorMsg = validator.start()
  
  return errorMsg
}

form.onsubmit = function() {
  const errorMsg = validateFunc()
  
  if (errorMsg) {
    console.log(errorMsg)
    return false
  }
}
```

æ€»ç»“ï¼Œç­–ç•¥æ¨¡å¼ä¸€ç§å¾ˆç®€å•ä¸”å¸¸è§çš„æ¨¡å¼ï¼ŒJSä¸­çš„å®ç°åœ¨ä¼ ç»Ÿçš„å®ç°ä¸Šï¼Œå¯ä»¥åˆ©ç”¨å…¶è‡ªèº«è¯­è¨€çš„åŠ¨æ€æ€§ï¼Œä½¿ç”¨ä¸åŒçš„æ–¹å¼è¿›è¡Œå®ç°ï¼Œç­–ç•¥æ¨¡å¼é™¤äº†å°è£…ä¸åŒç®—æ³•å¤–ï¼Œè¿˜å¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œå°è£…ã€‚

æ‰©å±•é˜…è¯»ï¼š

1. [ç­–ç•¥æ¨¡å¼ - è¡Œä¸ºæ¨¡å¼@Refactoring guru](https://refactoringguru.cn/design-patterns/strategy)
2. [ç­–ç•¥æ¨¡å¼ - æ°´çƒæ½˜@youtube ğŸŒŸå¼ºçƒˆæ¨è](https://www.youtube.com/watch?v=IkG_KuMpQRM&list=PLicQRHHL75d7EXEI9nWfUYJyrPdI79M70&ab_channel=%E6%B0%B4%E7%90%83%E6%BD%98)

2020-12-31 15:47:04

